{% macro project_icon_url(entry) %}
    /works/{{ entry.party.id|url_encode }}/{{ entry.id }}_icon.png
{% endmacro %}

{% macro project_icon(entry) %}
    {% import _self as self %}
    <img src="{{ self.project_icon_url(entry) }}" alt="{{ entry.name }}"/>
{% endmacro %}

{% macro project_block(entry, current_user) %}
    {% import 'GeekPartyBundle::_comments/macros.html.twig' as comments %}
    {% import _self as self %}

    {% set partyId = entry.party is not null ? entry.party.id : null %}
    {% set entryPage = path('geek_browse_work', { party: partyId, work: entry.id }) %}


    <div class="gdp-work gdp-border">
        <div class="gdp-work-header">
            <p class="gdp-work-name">{{ entry.name }}</p>
            {# keereal тут нужно имя пользователя #}
            {#<p class="grp-work-author">by Игорёк Рагнарёк @2015-02-06 21:03:20</p>#}
        </div>
        <div class="gdp-work-sidebar">
            <div class="gdp-work-image-holder">
                <img
                        src="{{ self.project_icon_url(entry) }}" alt="{{ entry.name }}"
                        class="gdp-work-image">
            </div>

            {% if entry.party.ended %}
                {% set rating = calculate_project_rating(entry) %}
                <div class="gdp-rating">
                    <div class="gdp-rating-back"></div>
                    <div class="gdp-rating-front"
                            style="width: {{ 23.6 * rating }}px" title="{{ rating }}"></div>
                    <span>{{ rating|round(1)|number_format(1) }}</span>
                </div>
            {% endif %}
        </div>
        <p>{{ entry.description }}.</p>

        <div class="gdp-news-raw-footer">
            <a href="{{ entryPage }}">Подробнее</a>

            <a class="link-more text-right" href="{{ entryPage }}">Подробнее</a>
            <a class="link-comments text-right" href="#">Комментарии</a>

            {% if (entry.author == current_user or is_granted('ROLE_ADMIN')) and current_user is not null %}
                <a href="{{ path('project_edit', {'id': entry.id}) }}" class="link-comments text-right">Редактировать</a>
            {% endif %}
        </div>
    </div>
{% endmacro %}