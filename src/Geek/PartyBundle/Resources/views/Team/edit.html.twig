{% extends 'GeekPartyBundle::parent.html.twig' %}

{% block title %} GeekParty :: Редактирование команды {% endblock %}

{% macro teamMember(member) %}
    <table class="memberRow">
        <tr>
            <td>
                <table>
                    <tr valign="top">
                        <td>nickname</td>
                        <td>skill & tools</td>
                    </tr>
                    <tr valign="top">
                        <td><input class="participant" type="text" size=10 name="member[name][]" {%if member %}value="{{member.name}}"{%endif%}></td>
                        <td><textarea class="participant" rows="5" cols="28" name="member[description][]">{% if member %}{{member.description}}{%endif%}</textarea></td>
                    </tr>
                </table>
            </td>
            <td><input class="removeMember" type="button" value="Remove"/></td>
        </tr>
    </table>
{% endmacro %}

{% block main %}
    <div style="display:none" id="teamMemberTemplate">
        {{ _self.teamMember() }}
    </div>
    <script>
        var formIsChanged = false;

        var templateRow = function(id) {
            return '';
        }

        var removeRow = function(id) {
            $('#participantrow'+id).remove();
        }

        var submitForm = function() {
            $('#teamForm').submit();

            formIsChanged = false;
            validateChangeAlert();
        }

        var formChanged = function() {

            formIsChanged = true;
            validateChangeAlert();
        }


        var memberTemplate
        var renderBlankMemberForm = function () {
            $('#regFormParticipants').append(memberTemplate.clone().addClass('new'))
        }

        var validateChangeAlert = function() {
            $('#topSave').toggle(formIsChanged)
            $('#botSave').toggle(formIsChanged)
        }

        $(document).ready(function() {
            memberTemplate = $('#teamMemberTemplate').find('.memberRow')

            // Кнопка удаления члена команды
            $(document).on('click', '.removeMember', function () {
                $(this).parents('.memberRow').remove()
            })

            // Изменение формы при изменении члена команды
            $(document).on('change', '.memberRow input, .memberRow textarea', formChanged)

            // Изменение пустой формы
            $(document).on('change', '.memberRow.new input', function () {
                $(this).parents('.memberRow').removeClass('new')
                renderBlankMemberForm()
            })

            validateChangeAlert();

            $('#teamAttributes input').change(formChanged);
            $('.submitTeamReg').click(submitForm);

            renderBlankMemberForm()
        })
    </script>
    <div class="content">
        <div class="briefLine">
            <div class="briefDescription">
                <a href="{{ path('geek_people') }}">&larr; назад к списку команд</a>
                <form action="{%if entity.id %}{{ path('team_update', { 'id': entity.id }) }}{% else %}{{ path('team_create') }}{% endif %}" method="post" {{ form_enctype(edit_form) }}>
                    {% if entity.id %}
                        <input type="hidden" name="id" value="{{entity.id}}"/>
                    {% endif %}
                    {{ form_widget(edit_form._token) }}

                    <div id="teamRegistration">

                        <h2>Управление командой</h2>

                        {# Команда активна:<input type="checkbox"/> #}

                        <div id="topSave">
                            Данные команды были изменены
                            <input class="submitTeamReg" type="submit" value="Сохранить"/>
                        </div>

                        <form id="teamForm" action="">
                            <table id="teamAttributes">
                                <tr valign="top">
                                    <td>Название</td>
                                    <td>{{ form_widget(edit_form.name) }}</td>
                                    <td></td>
                                </tr>
                                <tr valign="top">
                                    <td>Описание</td>
                                    <td>{{ form_widget(edit_form.description) }}</td>
                                    <td>140</td>
                                </tr>
                                <tr valign="top">
                                    <td>Контакты</td>
                                    <td>{{ form_widget(edit_form.contacts) }}</td>
                                    <td>Skype, Вконтакте, и т.п.</td>
                                </tr>
                            </table>

                            <h2>Участники</h2>
                            <div id="regFormParticipants">
                                {% for member in entity.members %}
                                    {{ _self.teamMember(member) }}
                                {% endfor %}
                            </div>
                        </form>



                        <div id="botSave">
                            Данные команды были изменены
                            <input class="submitTeamReg" type="submit" value="Сохранить"/>
                        </div>

                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
