<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>{% block title %} GeekParty {% endblock %}</title>
    <meta name="keywords" content="geekparty" />
    <meta name="description" content="Гик-пати — это цифровое творчество в режиме реального времени" />
    <meta name="vk:app_id" content="3561840" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="{{ asset("js/countdown.js") }}"></script>

    <link rel="stylesheet" type="text/css" href="{{ asset("css/style.css") }}" media="screen"/>
	<link rel="stylesheet" type="text/css" href="{{ asset("css/disqusFix.css") }}" media="screen"/>

    <link rel="shortcut icon" href="{{ asset("favicon.ico") }}" />
</head>
<body>
    <script type="text/javascript">
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '{{ fb_app_id }}',
                cookie     : true,
                xfbml      : true,
                status     : true,
                version    : 'v2.0'
            });
            FB.getLoginStatus(function(response) {
              statusChangeCallback(response);
            });
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // This is called with the results from from FB.getLoginStatus().
          function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            // The response object is returned with a status field that lets the
            // app know the current login status of the person.
            // Full docs on the response object can be found in the documentation
            // for FB.getLoginStatus().
            if (response.status === 'connected') {
              // Logged into your app and Facebook.
              testAPI();
            } else if (response.status === 'not_authorized') {
              // The person is logged into Facebook, but not your app.
              document.getElementById('status').innerHTML = 'Please log ' +
                'into this app.';
            } else {
              // The person is not logged into Facebook, so we're not sure if
              // they are logged into this app or not.
              document.getElementById('status').innerHTML = 'Please log ' +
                'into Facebook.';
            }
          }

          // This function is called when someone finishes with the Login
          // Button.  See the onlogin handler attached to it in the sample
          // code below.
          function checkLoginState() {
            FB.getLoginStatus(function(response) {
              statusChangeCallback(response);
            });
          }

          // Here we run a very simple test of the Graph API after login is
          // successful.  See statusChangeCallback() for when this call is made.
          function testAPI() {
            FB.api('/me', function(response) {
              console.log('Successful login for: ' + response.name);
            });
          }
    </script>
    <script type="text/javascript" src="{{ asset("js/script.js") }}"></script>
	<div id="gradient"></div>
    <div id="clouds"></div>
	<div id="wrapper">
		<div id="sidebar">
			<div id="sidebarFX"></div>
			<ul id="navigation">
                {% set current_route = app.request.attributes.get('_route') %}
                {% set menu = { 
                    'geek_index': 'Main',  
                    'geek_about': 'About',
                    'geek_browse': 'Works'
                    } %}
                {% for route, page in menu %}
                    <li{% if route == current_route %} class="navActive"{% endif %}><a href="{{ path(route) }}">{{page}}</a></li>
                {% endfor %}
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <li class="Special{% if '/edit' in app.request.requestUri  %} navActive{% endif %}"><a href="{{ path('project') }}">Upload</a></li>
                {% endif %}
                {% if is_granted('ROLE_ADMIN') %}
                    <li class="Special{% if '/admin' in app.request.requestUri  %} navActive{% endif %}"><a href="{{ path('admin') }}">Admin</a></li>
                {% endif %}
			</ul>
		</div>
		
		<div id="container">
			<div id="header">
				<div id="sitelogo">
					<a href="/">
						<img src="{{ asset("img/logo-gp.png") }}" alt="GeekParty" />
					</a>
				</div>
                {% if current_party %}
                    <div id="timer" class="{% if current_party and current_party.startTime|date('Y-m-d H:i:s') < 'now'|date('Y-m-d H:i:s') %}showtime{%endif%}">
                    {% if current_party.endTime|date('Y-m-d H:i:s') < 'now'|date('Y-m-d H:i:s') %}
                        {# Последнее пати закончилось #}
                        <p class="timerLabel showtime">{{ current_party.name }} состоялось!</p>
                    {% elseif current_party.endTime|date('Y-m-d H:i:s') > 'now'|date('Y-m-d H:i:s') %}
                        {# Пати еще не началось или еще не закончилось #}
                        {% if current_party.isCurrent %}
                            <p>{{ current_party.name }} закончится через: </p>
                        {% endif %}
                        <script type="text/javascript">
                            window.targetDate = {% if current_party.startTime|date('Y-m-d H:i:s') > 'now'|date('Y-m-d H:i:s') %}
                                    "{{ current_party.startTime|date('Y-m-d H:i:s') }}"
                                {% else %}
                                    "{{ current_party.endTime|date('Y-m-d H:i:s') }}"
                                {% endif %};
                        </script>
                        <p id="days" class="timerLabel">01</p>
                        <p id="dhColon" class="timerLabel">:</p>
                        <p id="hours" class="timerLabel">08</p>
                        <p id="hmColon" class="timerLabel">:</p>
                        <p id="minutes" class="timerLabel">23</p>
                    {% endif %}
                    </div>
                {% endif %}
                <div id="cross-site-logo">
                    <a href="http://nextcastle.ru/" target="_blank">
						<img src="{{ asset("img/logo-nc.png") }}" alt="NextCastle" />
					</a>
                </div>
                <div class="socialContainer">
                    <div id="vk_like"></div>
                    <script type="text/javascript">
                        window.runAfterVkInit(function () {
                            VK.Widgets.Like("vk_like", {
                                type: "mini",
                                pageImage: "http://geekparty.ru/img/logo.png",
                                pageUrl: "http://geekparty.ru/",
                                text: "Гикпати.Ру - хорошее мерориятие"
                            });
                        })
                    </script>
                    <div class="fb-like" data-href="http://geekparty.ru/" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>
                    <div class="socialTwitterButton">
                        <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ru" data-hashtags="geekpartyru" data-url="http://geekparty.ru/" data-text="Гикпати.Ру — хорошее мерориятие">Tweet</a>
                        <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    </div>
                </div>
			</div>
			<div id="headerBorder"></div>
			<div id="page">
                {% for flashMessage in app.session.flashbag.get('notice') %}
                    <div class="error-message">
                        {{ flashMessage }}
                    </div>
                {% endfor %}
				{% block main %} {% endblock %}
				<div id="footer">
					<div id="footerDescription">
						<p class="usePixelFont">GEEK PARTY (c) {{ "now"|date('Y') }} | geekparty.ru@gmail.com</p>
					</div>
					<div id="footerBlock"></div>
				</div>
			</div> <!-- page -->
		</div> <!-- containert -->
	</div> <!-- wrapper -->
    <div id="vk_api_transport"></div>
</body>
</html>
